syntax = "proto3";

package keruberosu.v1;

import "keruberosu/v1/common.proto";

option go_package = "github.com/asakaida/keruberosu/proto/keruberosu/v1;keruberosupb";

// ========================================
// Schema Service (Permify互換)
// スキーマ管理
// ========================================

service Schema {
  rpc Write(SchemaWriteRequest) returns (SchemaWriteResponse);
  rpc Read(SchemaReadRequest) returns (SchemaReadResponse);
  rpc List(SchemaListRequest) returns (SchemaListResponse);
}

// ========================================
// Schema Service Messages
// ========================================

message SchemaWriteRequest {
  string schema = 1;  // Permify互換: schema_dsl → schema
}

message SchemaWriteResponse {
  string schema_version = 1;  // ULID形式のバージョンID
}

message SchemaReadRequest {
  PermissionCheckMetadata metadata = 1;  // schema_versionを指定可能
}

message SchemaReadResponse {
  string schema = 1;  // Permify互換: schema_dsl → schema
  string updated_at = 2;
}

message SchemaListRequest {
  int32 page_size = 1;          // 取得するバージョン数（1-100）
  string continuous_token = 2;   // ページネーション用トークン
}

message SchemaListResponse {
  string head = 1;                      // 最新バージョン
  repeated SchemaListItem schemas = 2;   // バージョンリスト
  string continuous_token = 3;          // 次のページ用トークン
}

message SchemaListItem {
  string version = 1;      // ULIDバージョンID
  string created_at = 2;   // ISO8601形式のタイムスタンプ
}
